<!DOCTYPE html>

<html lang="zh-CN">

<head>
  
  <title>go-client - ruanzhijun</title>
  <meta charset="UTF-8">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  
  

  <link rel="shortcut icon" href="/images/favicon.jpg" type="image/jpg" />
  <meta name="description" content="开发桌面客户端软件一直是程序员的常见任务之一，而Go语言凭借其简洁、高效以及丰富的第三方库，越来越多地被用于开发各类应用程序。今天我们将结合Go语言和HTML，使用开源项目 Sciter 的 Go 绑定库 go-sciter，为大家展示如何用最少的开发精力构建一个跨平台的桌面客户端。 什么是Sciter？Sciter 是一个支持多平台的嵌入式HTML&#x2F;CSS&#x2F;脚本引擎，适用于构">
<meta property="og:type" content="article">
<meta property="og:title" content="go-client">
<meta property="og:url" content="https://ruanzhijun.cn/2024/11/20/go-client/index.html">
<meta property="og:site_name" content="ruanzhijun">
<meta property="og:description" content="开发桌面客户端软件一直是程序员的常见任务之一，而Go语言凭借其简洁、高效以及丰富的第三方库，越来越多地被用于开发各类应用程序。今天我们将结合Go语言和HTML，使用开源项目 Sciter 的 Go 绑定库 go-sciter，为大家展示如何用最少的开发精力构建一个跨平台的桌面客户端。 什么是Sciter？Sciter 是一个支持多平台的嵌入式HTML&#x2F;CSS&#x2F;脚本引擎，适用于构">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-11-20T04:58:04.000Z">
<meta property="article:modified_time" content="2024-11-20T05:06:40.965Z">
<meta property="article:author" content="ruanzhijun">
<meta property="article:tag" content="go">
<meta name="twitter:card" content="summary">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/combine/gh/nexmoe/nexmoe.github.io@latest/css/style.css,npm/highlight.js@9.15.8/styles/atom-one-dark.css,gh/nexmoe/nexmoe.github.io@latest/lib/mdui_043tiny/css/mdui.css,gh/nexmoe/nexmoe.github.io@latest/lib/iconfont/iconfont.css" crossorigin>
  
  <!--<link rel="stylesheet" href="/css/style.css?v=1732079215025">-->

  
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="mdui-drawer-body-left">
  
  <div id="nexmoe-background">
    <div class="nexmoe-bg" style="background-image: url()"></div>
    <div class="mdui-appbar mdui-shadow-0">
      <div class="mdui-toolbar">
        <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon nexmoefont icon-menu"></i></a>
        <div class="mdui-toolbar-spacer"></div>
        <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
        <a href="/" title="ruanzhijun" class="mdui-btn mdui-btn-icon"><img src="/images/favicon.jpg" alt="ruanzhijun"></a>
       </div>
    </div>
  </div>
  <div id="nexmoe-header">
      <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="ruanzhijun">
            <img src="/images/favicon.jpg" alt="ruanzhijun" alt="ruanzhijun">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>文章</span>7</div>
        <div><span>标签</span>8</div>
        <div><span>分类</span>2</div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/archives" title="文章归档">
            <i class="mdui-list-item-icon nexmoefont icon-container"></i>
            <div class="mdui-list-item-content">
                文章归档
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/about.html" title="关于博客">
            <i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
            <div class="mdui-list-item-content">
                关于博客
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/PY.html" title="我的朋友">
            <i class="mdui-list-item-icon nexmoefont icon-unorderedlist"></i>
            <div class="mdui-list-item-content">
                我的朋友
            </div>
        </a>
        
    </div>
    <aside id="nexmoe-sidebar">
  
  <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search">
        <form id="search_form" action_e="https://cn.bing.com/search?q=site:nexmoe.com" onsubmit="return search();">
            <label><input id="search_value" name="q" type="search" placeholder="搜索"></label>
        </form>
    </div>
</div>
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">社交按钮</h3>
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="https://github.com/ruanzhijun/" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a>
    </div>
</div>
  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章分类</h3>
    <div class="nexmoe-widget">

      <ul class="category-list">

        


        

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/技术文章/">技术文章</a>
          <span class="category-list-count">6</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/运维相关/">运维相关</a>
          <span class="category-list-count">1</span>
        </li>

        
      </ul>

    </div>
  </div>


  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">标签云</h3>
    <div id="randomtagcloud" class="nexmoe-widget tagcloud nexmoe-rainbow">
      <a href="/tags/go/" style="font-size: 20px;">go</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/quic/" style="font-size: 10px;">quic</a> <a href="/tags/rtmp/" style="font-size: 10px;">rtmp</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 10px;">多线程</a> <a href="/tags/%E6%97%A5%E5%BF%97/" style="font-size: 10px;">日志</a> <a href="/tags/%E7%9B%B4%E6%92%AD/" style="font-size: 10px;">直播</a>
    </div>
    
  </div>

  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章归档</h3>
    <div class="nexmoe-widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">十一月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/10/">十月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li></ul>
    </div>
  </div>


  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">最新文章</h3>
    <div class="nexmoe-widget">
      <ul>
        
          <li>
            <a href="/2024/11/20/go-client/">go-client</a>
          </li>
        
          <li>
            <a href="/2024/11/13/api-limit/">API接口限流就是这么简单</a>
          </li>
        
          <li>
            <a href="/2024/11/05/go-log/">Go 统一日志处理</a>
          </li>
        
          <li>
            <a href="/2024/11/02/goroutine/">Go Goroutine 究竟可以开多少</a>
          </li>
        
          <li>
            <a href="/2024/10/31/go-context/">Go语言中的context包到底解决了啥问题？</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
    <div class="nexmoe-copyright">
        &copy; 2024 ruanzhijun
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://nexmoe.com/hexo-theme-nexmoe.html" target="_blank">Nexmoe</a>
        <br><a href="http://beian.miit.gov.cn/" target="_blank">京ICP备16028275号-1</a>
    </div>
</div><!-- .nexmoe-drawer -->

  </div>
  <div id="nexmoe-content">
    <div class="nexmoe-primary">
        <div class="nexmoe-post">
  
      <div class="nexmoe-post-cover" style="padding-bottom: NaN%;"> 
          <img data-src="/images/go-client/cover.jpg" data-sizes="auto" alt="go-client" class="lazyload">
          <h1>go-client</h1>
      </div>
  
  
  <div class="nexmoe-post-meta nexmoe-rainbow" style="margin:10px 0!important;">
    <a><i class="nexmoefont icon-calendar-fill"></i>2024年11月20日</a>
    <a><i class="nexmoefont icon-areachart"></i>4k 字</a>
    <a><i class="nexmoefont icon-time-circle-fill"></i>大概 22 分钟</a>
</div>

  <div class="nexmoe-post-right">
    
  </div>

  <article>
    <p>开发桌面客户端软件一直是程序员的常见任务之一，而Go语言凭借其简洁、高效以及丰富的第三方库，越来越多地被用于开发各类应用程序。今天我们将结合Go语言和HTML，使用开源项目 Sciter 的 Go 绑定库 go-sciter，为大家展示如何用最少的开发精力构建一个跨平台的桌面客户端。</p>
<h2 id="什么是Sciter？"><a href="#什么是Sciter？" class="headerlink" title="什么是Sciter？"></a>什么是Sciter？</h2><p>Sciter 是一个支持多平台的嵌入式HTML&#x2F;CSS&#x2F;脚本引擎，适用于构建本地桌面应用程序，且它的性能非常好。通过 go-sciter，我们可以用Go语言来调用Sciter引擎，进而使用HTML、CSS和JavaScript创建用户界面，并与Go的后端逻辑交互。</p>
<h2 id="为什么选择Sciter？"><a href="#为什么选择Sciter？" class="headerlink" title="为什么选择Sciter？"></a>为什么选择Sciter？</h2><ul>
<li><strong>轻量级：</strong> Sciter非常轻量，适合需要快速构建的桌面应用。</li>
<li><strong>跨平台：</strong> 支持Windows、macOS和Linux操作系统。</li>
<li><strong>无需第三方浏览器依赖：</strong> 与Electron不同，Sciter不需要依赖外部的浏览器引擎，极大减少了应用程序的体积。</li>
<li><strong>使用现代的前端技术：</strong> 支持HTML5、CSS3和JavaScript，前端开发者可以快速上手。</li>
</ul>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><h3 id="1-安装Go‌：‌"><a href="#1-安装Go‌：‌" class="headerlink" title="1. 安装Go‌：‌"></a>1. 安装Go‌：‌</h3><p>我们默认认为你已经安装了Go。如果没有安装，可以从 Go官网 下载并安装。安装完成后，执行以下命令确认Go是否正确安装：</p>
<pre><code class="hljs go"><span class="hljs-keyword">go</span> version</code></pre>

<p><strong>注意</strong><br>因为是cgo开发，因此 WIndows 用户还需要安装 <code>mingw64-gcc</code>。</p>
<h3 id="2-安装Sciter-SDK"><a href="#2-安装Sciter-SDK" class="headerlink" title="2. 安装Sciter SDK"></a>2. 安装Sciter SDK</h3><p>前往 Sciter官网 下载Sciter SDK，选择适合你操作系统的版本（Windows、macOS或Linux）。解压后将 bin 目录中的动态库文件（dll、so或dylib）放到系统的环境变量中，或者与可执行文件一起存放，具体请看 Sciter 官方文档。</p>
<p><strong>注意事项</strong><br>由于 go-sciter 这两年没有及时更新，其实最新的 Sciter SDK 并不适合使用，因此你需要下载 <code>4.4.8</code> 版本的 Sciter SDK，太新的不行。</p>
<h3 id="3-安装go-sciter"><a href="#3-安装go-sciter" class="headerlink" title="3. 安装go-sciter"></a>3. 安装go-sciter</h3><p>通过Go命令安装 go-sciter 包：</p>
<pre><code class="hljs go"><span class="hljs-keyword">go</span> get github.com/sciter-sdk/<span class="hljs-keyword">go</span>-sciter</code></pre>

<h2 id="开始编写客户端程序"><a href="#开始编写客户端程序" class="headerlink" title="开始编写客户端程序"></a>开始编写客户端程序</h2><p>为了方便举例，我以当前随手写的一个桌面应用为例，展开说明。</p>
<p>简单说明一下，这个项目的功能是：自动提交网站的 URL 到 Google 推送服务器。下面不是一个完整的项目代码，因为还涉及到数据库操作，网站Sitemap的扒取等等，因此只列出了重要的部分。</p>
<p>首先创建一个项目，我们暂且取名为 <code>gosciter</code> 吧。创建项目的过程不赘述。</p>
<p>将 sciter.dll 或者 <code>libsciter.dylib</code>(MacOS用户) 放到项目根目录下。</p>
<p>如果需要用到 sqlite 数据库，也需要拷贝 sciter-sqlite.dll 或者 sciter-sqlite.dylib 过来。我的项目用到了，因此这个文件也复制过来了。</p>
<h3 id="编写-main-go"><a href="#编写-main-go" class="headerlink" title="编写 main.go"></a>编写 main.go</h3><pre><code class="hljs go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">&quot;embed&quot;</span>
	<span class="hljs-string">&quot;encoding/json&quot;</span>
	<span class="hljs-string">&quot;fmt&quot;</span>
	<span class="hljs-string">&quot;github.com/ncruces/zenity&quot;</span>
	<span class="hljs-string">&quot;github.com/sciter-sdk/go-sciter&quot;</span>
	<span class="hljs-string">&quot;github.com/sciter-sdk/go-sciter/window&quot;</span>
	<span class="hljs-string">&quot;github.com/skratchdot/open-golang/open&quot;</span>
	<span class="hljs-string">&quot;log&quot;</span>
	<span class="hljs-string">&quot;os&quot;</span>
	<span class="hljs-string">&quot;strconv&quot;</span>
	<span class="hljs-string">&quot;strings&quot;</span>
	<span class="hljs-string">&quot;time&quot;</span>
)

<span class="hljs-comment">// 为了让生成的可执行文件包含了界面文件，直接把views文件夹嵌入到可执行文件中</span>

<span class="hljs-comment">//go:embed all:views</span>
<span class="hljs-keyword">var</span> views embed.FS

<span class="hljs-comment">// 定义一个Map类型的数据结构</span>
<span class="hljs-keyword">type</span> Map <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;
	w, err := window.New(sciter.SW_TITLEBAR|sciter.SW_RESIZEABLE|sciter.SW_CONTROLS|sciter.SW_MAIN|sciter.SW_ENABLE_DEBUG, &amp;sciter.Rect&#123;
		Left:   <span class="hljs-number">100</span>,
		Top:    <span class="hljs-number">50</span>,
		Right:  <span class="hljs-number">1100</span>,
		Bottom: <span class="hljs-number">660</span>,
	&#125;)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;
		log.Fatal(err)
	&#125;

  <span class="hljs-comment">// 定义一个回调函数，用于处理加载资源，home 是自定义的Scheme</span>
	w.SetCallback(&amp;sciter.CallbackHandler&#123;
		OnLoadData: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(params *sciter.ScnLoadData)</span></span> <span class="hljs-type">int</span> &#123;
			<span class="hljs-keyword">if</span> strings.HasPrefix(params.Uri(), <span class="hljs-string">&quot;home://&quot;</span>) &#123;
				fileData, err := views.ReadFile(params.Uri()[<span class="hljs-number">7</span>:])
				<span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> &#123;
					w.DataReady(params.Uri()[<span class="hljs-number">7</span>:], fileData)
				&#125;
			&#125;
			<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
		&#125;,
	&#125;)

  <span class="hljs-comment">// 这里定义一些与前端交互的函数</span>
	w.DefineFunction(<span class="hljs-string">&quot;openUrl&quot;</span>, openUrl)
	w.DefineFunction(<span class="hljs-string">&quot;getIndexingTasks&quot;</span>, getIndexingTasks)
	w.DefineFunction(<span class="hljs-string">&quot;getIndexingTask&quot;</span>, getIndexingTask)
	w.DefineFunction(<span class="hljs-string">&quot;getIndexingUrls&quot;</span>, getIndexingUrls)
	w.DefineFunction(<span class="hljs-string">&quot;openAccountJson&quot;</span>, openAccountJson)
	w.DefineFunction(<span class="hljs-string">&quot;loadIndexingSitemap&quot;</span>, loadIndexingSitemap)
	w.DefineFunction(<span class="hljs-string">&quot;createGoogleIndexing&quot;</span>, createGoogleIndexing)
	w.DefineFunction(<span class="hljs-string">&quot;startGoogleIndexing&quot;</span>, startGoogleIndexing)
	w.DefineFunction(<span class="hljs-string">&quot;stopGoogleIndexing&quot;</span>, stopGoogleIndexing)
	w.DefineFunction(<span class="hljs-string">&quot;deleteGoogleIndexing&quot;</span>, deleteGoogleIndexing)

  <span class="hljs-comment">// 加载主页面</span>
	mainView, err := views.ReadFile(<span class="hljs-string">&quot;views/main.html&quot;</span>)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;
		fmt.Print(<span class="hljs-string">&quot;nofile&quot;</span>, err)
		os.Exit(<span class="hljs-number">0</span>)
	&#125;
	w.LoadHtml(<span class="hljs-type">string</span>(mainView), <span class="hljs-string">&quot;&quot;</span>)

	w.SetTitle(<span class="hljs-string">&quot;谷歌推送&quot;</span>)
	w.Show()
	w.Run()
&#125;


<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">openUrl</span><span class="hljs-params">(args ...*sciter.Value)</span></span> *sciter.Value &#123;
	link := args[<span class="hljs-number">0</span>].String()
	_ = open.Run(link)

	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getIndexingTasks</span><span class="hljs-params">(args ...*sciter.Value)</span></span> *sciter.Value &#123;
	<span class="hljs-comment">//tasks := service.GetIndexingTasks()</span>
  <span class="hljs-keyword">var</span> task = []Map&#123;&#125;
	<span class="hljs-comment">// 返回Json格式</span>
	<span class="hljs-keyword">return</span> jsonValue(tasks)
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getIndexingTask</span><span class="hljs-params">(args ...*sciter.Value)</span></span> *sciter.Value &#123;
	index, _ := strconv.Atoi(args[<span class="hljs-number">0</span>].String())
	<span class="hljs-comment">//task := service.GetIndexingTask(index)</span>
  task := Map&#123;&#125;
	<span class="hljs-comment">// 返回Json格式</span>
	<span class="hljs-keyword">return</span> jsonValue(task)
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getIndexingUrls</span><span class="hljs-params">(args ...*sciter.Value)</span></span> *sciter.Value &#123;
	index, _ := strconv.Atoi(args[<span class="hljs-number">0</span>].String())
	page, _ := strconv.Atoi(args[<span class="hljs-number">1</span>].String())
	<span class="hljs-keyword">if</span> page &lt; <span class="hljs-number">1</span> &#123;
		page = <span class="hljs-number">1</span>
	&#125;
	<span class="hljs-comment">//urls, totalPage := service.GetIndexingUrls(index, page)</span>
  urls := []<span class="hljs-type">string</span>&#123;&#125;
  totalPage := <span class="hljs-number">0</span>
	<span class="hljs-comment">// 返回Json格式</span>
	<span class="hljs-keyword">return</span> jsonValue(Map&#123;<span class="hljs-string">&quot;urls&quot;</span>: urls, <span class="hljs-string">&quot;page&quot;</span>: page, <span class="hljs-string">&quot;totalPage&quot;</span>: totalPage&#125;)
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">openAccountJson</span><span class="hljs-params">(args ...*sciter.Value)</span></span> *sciter.Value &#123;
	accountPath, err := zenity.SelectFile(zenity.Title(<span class="hljs-string">&quot;选择Account Json文件&quot;</span>), zenity.FileFilter&#123;
		Name:     <span class="hljs-string">&quot;Json file&quot;</span>,
		Patterns: []<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;*.json&quot;</span>&#125;,
		CaseFold: <span class="hljs-literal">false</span>,
	&#125;)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> || accountPath == <span class="hljs-string">&quot;&quot;</span> &#123;
		fmt.Println(err)
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
	&#125;

	<span class="hljs-keyword">return</span> sciter.NewValue(accountPath)
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createGoogleIndexing</span><span class="hljs-params">(args ...*sciter.Value)</span></span> *sciter.Value &#123;
	accountPath := args[<span class="hljs-number">0</span>].String()
	domain := args[<span class="hljs-number">1</span>].String()
	tmpNum := args[<span class="hljs-number">2</span>].String()
	dailyNum, _ := strconv.Atoi(tmpNum)

	<span class="hljs-keyword">if</span> dailyNum == <span class="hljs-number">0</span> &#123;
		dailyNum = <span class="hljs-number">200</span>
	&#125;
	<span class="hljs-keyword">if</span> !strings.HasPrefix(domain, <span class="hljs-string">&quot;http&quot;</span>) &#123;
		<span class="hljs-keyword">return</span> sciter.NewValue(<span class="hljs-string">&quot;网址填写错误&quot;</span>)
	&#125;
	<span class="hljs-comment">// err := service.CreateIndexing(accountPath, domain, dailyNum)</span>
	<span class="hljs-comment">// if err != nil &#123;</span>
	<span class="hljs-comment">// 	return sciter.NewValue(err.Error())</span>
	<span class="hljs-comment">// &#125;</span>

	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">loadIndexingSitemap</span><span class="hljs-params">(args ...*sciter.Value)</span></span> *sciter.Value &#123;
	index, _ := strconv.Atoi(args[<span class="hljs-number">0</span>].String())

	<span class="hljs-comment">// err := service.LoadIndexingSitemap(index, false)</span>
	<span class="hljs-comment">// if err != nil &#123;</span>
	<span class="hljs-comment">// 	return sciter.NewValue(err.Error())</span>
	<span class="hljs-comment">// &#125;</span>

	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">startGoogleIndexing</span><span class="hljs-params">(args ...*sciter.Value)</span></span> *sciter.Value &#123;
	index, _ := strconv.Atoi(args[<span class="hljs-number">0</span>].String())

	<span class="hljs-comment">// err := service.StartGoogleIndexing(index)</span>

	<span class="hljs-comment">// if err != nil &#123;</span>
	<span class="hljs-comment">// 	return sciter.NewValue(err.Error())</span>
	<span class="hljs-comment">// &#125;</span>

	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">stopGoogleIndexing</span><span class="hljs-params">(args ...*sciter.Value)</span></span> *sciter.Value &#123;
	index, _ := strconv.Atoi(args[<span class="hljs-number">0</span>].String())

	<span class="hljs-comment">//service.StopGoogleIndexing(index)</span>

	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">deleteGoogleIndexing</span><span class="hljs-params">(args ...*sciter.Value)</span></span> *sciter.Value &#123;
	index, _ := strconv.Atoi(args[<span class="hljs-number">0</span>].String())

	<span class="hljs-comment">// 需要先stop</span>
	<span class="hljs-comment">// service.StopGoogleIndexing(index)</span>
	<span class="hljs-comment">// // 最后删除</span>
	<span class="hljs-comment">// service.DeleteIndexingTask(index)</span>

	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">jsonValue</span><span class="hljs-params">(val <span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> *sciter.Value &#123;
	buf, err := json.Marshal(val)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
	&#125;
	<span class="hljs-keyword">return</span> sciter.NewValue(<span class="hljs-type">string</span>(buf))
&#125;</code></pre>

<h3 id="编写-views-main-html"><a href="#编写-views-main-html" class="headerlink" title="编写 views&#x2F;main.html"></a>编写 views&#x2F;main.html</h3><p>主页面没有什么特别之处，只是使用了自定义的scheme <code>home://</code></p>
<pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">resizeable</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;home://views/style.css&quot;</span> /&gt;</span><span class="language-xml"></span>
<span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charSet</span>=<span class="hljs-string">&quot;utf-8&quot;</span> /&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;layout&quot;</span>&gt;</span></span>
<span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;aside&quot;</span>&gt;</span></span>
<span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;soft-title&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;home://views/main.html&quot;</span>&gt;</span>谷歌<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>推送助手<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>
<span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;aside-menus&quot;</span>&gt;</span></span>
<span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;home://views/task.html&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;menu-item&quot;</span>&gt;</span>推送任务<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span>
<span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;home://views/help.html&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;menu-item&quot;</span>&gt;</span>使用教程<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span>
<span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span></span>
<span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;home&quot;</span>&gt;</span></span>
<span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>欢迎使用 谷歌推送助手<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;start-control&quot;</span>&gt;</span></span>
<span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;home://views/task.html&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;start-btn&quot;</span>&gt;</span>开始使用<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span>
<span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml"></span>
<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span></code></pre>

<h3 id="编写-views-task-html"><a href="#编写-views-task-html" class="headerlink" title="编写 views&#x2F;task.html"></a>编写 views&#x2F;task.html</h3><p>主要的任务界面，这里则进行了列表渲染，上下翻页，以及按钮操作等处理。</p>
<pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">resizeable</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;home://views/style.css&quot;</span> /&gt;</span><span class="language-xml"></span>
<span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charSet</span>=<span class="hljs-string">&quot;utf-8&quot;</span> /&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;layout&quot;</span>&gt;</span></span>
<span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;aside&quot;</span>&gt;</span></span>
<span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;soft-title&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;home://views/main.html&quot;</span>&gt;</span>谷歌<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>推送助手<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>
<span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;aside-menus&quot;</span>&gt;</span></span>
<span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;home://views/task.html&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;menu-item active&quot;</span>&gt;</span>推送任务<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span>
<span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;home://views/help.html&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;menu-item&quot;</span>&gt;</span>使用教程<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span>
<span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span></span>
<span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;task-head&quot;</span>&gt;</span></span>
<span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> #<span class="hljs-attr">newTask</span>&gt;</span>新建任务<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
<span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;task-list&quot;</span> #<span class="hljs-attr">taskList</span>&gt;</span></span>
<span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">colgroup</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">col</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;30%&quot;</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">col</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;15%&quot;</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">col</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;15%&quot;</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">col</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;15%&quot;</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">col</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;30%&quot;</span>&gt;</span></span>
<span class="language-xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">colgroup</span>&gt;</span></span>
<span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span></span>
<span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>站点域名<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span></span>
<span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>URL数量<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span></span>
<span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>已推送/每日推送<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span></span>
<span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>状态<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span></span>
<span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>操作<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span>
<span class="language-xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span></span>
<span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span></span>
<span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">colspan</span>=<span class="hljs-string">&quot;5&quot;</span>&gt;</span>加载中<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span>
<span class="language-xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span>
<span class="language-xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span></span>
<span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span></span>
<span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;control-form&quot;</span> #<span class="hljs-attr">taslForm</span>&gt;</span></span>
<span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-header&quot;</span>&gt;</span></span>
<span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-close&quot;</span> #<span class="hljs-attr">resultClose</span>&gt;</span>关闭<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span>
<span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>创建/编辑任务<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span>
<span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-content&quot;</span>&gt;</span></span>
<span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-item&quot;</span>&gt;</span></span>
<span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-label&quot;</span>&gt;</span>网址或Sitemap地址：<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;input-block&quot;</span>&gt;</span></span>
<span class="language-xml">                    &lt;input(domain) class=&quot;layui-input&quot; type=&quot;text&quot; placeholder=&quot;http://或https://开头的网站地址或Sitemap地址&quot; /&gt;</span>
<span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;text-muted&quot;</span>&gt;</span>说明：如果填写了Sitemap地址，将自动获取Sitemap中的所有URL推送，<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>否则将抓取推送网址下的所有链接。<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-item&quot;</span>&gt;</span></span>
<span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-label&quot;</span>&gt;</span>选择AccountJson：<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;input-block text-left&quot;</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> #<span class="hljs-attr">selectAccountJson</span>&gt;</span>选择.json文件<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
<span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> #<span class="hljs-attr">accountJson</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;text-muted&quot;</span>&gt;</span>说明：需要上传谷歌账号的json文件，用于授权。<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-item&quot;</span>&gt;</span></span>
<span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-label&quot;</span>&gt;</span>每天推送数量：<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;input-block&quot;</span>&gt;</span></span>
<span class="language-xml">                    &lt;input(daily_num) class=&quot;layui-input&quot; type=&quot;text&quot; placeholder=&quot;默认200&quot; /&gt;</span>
<span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;text-muted&quot;</span>&gt;</span>说明：请根据你的接口限制，填写每天推送的量。<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;default&quot;</span> #<span class="hljs-attr">formClose</span>&gt;</span>返回<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
<span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;default&quot;</span> #<span class="hljs-attr">taskSubmit</span>&gt;</span>提交<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
<span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>
<span class="language-xml"></span>
<span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;result-list&quot;</span> #<span class="hljs-attr">resultList</span>&gt;</span></span>
<span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-header&quot;</span>&gt;</span></span>
<span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-close&quot;</span> #<span class="hljs-attr">resultClose</span>&gt;</span>关闭<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span>
<span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>查看结果<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span>
<span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-content&quot;</span>&gt;</span></span>
<span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">colgroup</span>&gt;</span></span>
<span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">col</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;40%&quot;</span>&gt;</span></span>
<span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">col</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;60%&quot;</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;/<span class="hljs-name">colgroup</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span></span>
<span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>网站网站<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span>
<span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> #<span class="hljs-attr">resultDomain</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span></span>
<span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>每日推送数量<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span>
<span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> #<span class="hljs-attr">resultDailyNum</span>&gt;</span>0条<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span></span>
<span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>执行状态<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span>
<span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> #<span class="hljs-attr">resultStatus</span>&gt;</span>waiting<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span></span>
<span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>已发现URL<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span>
<span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> #<span class="hljs-attr">resultUrlCount</span>&gt;</span>0条<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span></span>
<span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>已推送<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span>
<span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> #<span class="hljs-attr">resultDailyFinished</span>&gt;</span>0条<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span></span>
<span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>推送结果<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span>
<span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;text-left&quot;</span> #<span class="hljs-attr">resultResult</span>&gt;</span></span>
<span class="language-xml">                            /* <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>https://www.anqicms.com<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>失败<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span> */</span>
<span class="language-xml">                        <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span></span>
<span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span>
<span class="language-xml">                        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span></span>
<span class="language-xml">                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">                                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;pate-item&quot;</span>&gt;</span>页码：<span class="hljs-tag">&lt;<span class="hljs-name">span</span> #<span class="hljs-attr">resultPage</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>/<span class="hljs-tag">&lt;<span class="hljs-name">span</span> #<span class="hljs-attr">resultTotalPage</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span>
<span class="language-xml">                                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> #<span class="hljs-attr">resultPrev</span>&gt;</span>上一页<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
<span class="language-xml">                                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> #<span class="hljs-attr">resultNext</span>&gt;</span>下一页<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
<span class="language-xml">                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">                        <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span>
<span class="language-xml">                    <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span></span>
<span class="language-xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span></span>
<span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml"></span>
<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>
<span class="language-xml"></span>
<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/tiscript&quot;</span>&gt;</span><span class="language-javascript"></span></span>
<span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">syncTasks</span>(<span class="hljs-params"></span>) &#123;</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">let</span> res = view.<span class="hljs-title function_">getIndexingTasks</span>()</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">let</span> result = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(res)</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-comment">// 重置 #taskList</span></span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">let</span> tb = $(#taskList&gt;tbody)</span></span>
<span class="language-javascript"><span class="language-xml">        tb.<span class="hljs-property">html</span> = <span class="hljs-string">&quot;&quot;</span></span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">if</span> (!result) &#123;</span></span>
<span class="language-javascript"><span class="language-xml">            <span class="hljs-keyword">return</span>;</span></span>
<span class="language-javascript"><span class="language-xml">        &#125;</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; result.<span class="hljs-property">length</span>; i++) &#123;</span></span>
<span class="language-javascript"><span class="language-xml">            <span class="hljs-keyword">let</span> task = result[i];</span></span>
<span class="language-javascript"><span class="language-xml">            <span class="hljs-keyword">let</span> tr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Element</span>(#tr)</span></span>
<span class="language-javascript"><span class="language-xml">            tr.<span class="hljs-title function_">append</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Element</span>(#td, task.<span class="hljs-property">domain</span>))</span></span>
<span class="language-javascript"><span class="language-xml">            tr.<span class="hljs-title function_">append</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Element</span>(#td, task.<span class="hljs-property">url_count</span> + <span class="hljs-string">&quot;&quot;</span>))</span></span>
<span class="language-javascript"><span class="language-xml">            tr.<span class="hljs-title function_">append</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Element</span>(#td, task.<span class="hljs-property">daily_finished</span> + <span class="hljs-string">&quot;/&quot;</span> + task.<span class="hljs-property">daily_num</span>))</span></span>
<span class="language-javascript"><span class="language-xml">            tr.<span class="hljs-title function_">append</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Element</span>(#td, task.<span class="hljs-property">status</span> + <span class="hljs-string">&quot;&quot;</span>))</span></span>
<span class="language-javascript"><span class="language-xml">            <span class="hljs-keyword">let</span> td = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Element</span>(#td)</span></span>
<span class="language-javascript"><span class="language-xml">            td.@#<span class="hljs-keyword">class</span> = <span class="hljs-string">&quot;control-btns&quot;</span></span></span>
<span class="language-javascript"><span class="language-xml">            td.<span class="hljs-property">attributes</span>[<span class="hljs-string">&quot;id&quot;</span>] = <span class="hljs-string">&quot;task-&quot;</span> + task.<span class="hljs-property">id</span></span></span>
<span class="language-javascript"><span class="language-xml"></span></span>
<span class="language-javascript"><span class="language-xml">            <span class="hljs-title function_">addControlBtn</span>(td, <span class="hljs-string">&quot;结果&quot;</span>, <span class="hljs-string">&quot;task-result&quot;</span>)</span></span>
<span class="language-javascript"><span class="language-xml">            <span class="hljs-keyword">if</span> (task.<span class="hljs-property">status</span> == <span class="hljs-string">&quot;running&quot;</span>) &#123;</span></span>
<span class="language-javascript"><span class="language-xml">                <span class="hljs-title function_">addControlBtn</span>(td, <span class="hljs-string">&quot;停止&quot;</span>, <span class="hljs-string">&quot;task-stop&quot;</span>)</span></span>
<span class="language-javascript"><span class="language-xml">            &#125; <span class="hljs-keyword">else</span> &#123;</span></span>
<span class="language-javascript"><span class="language-xml">                <span class="hljs-title function_">addControlBtn</span>(td, <span class="hljs-string">&quot;启动&quot;</span>, <span class="hljs-string">&quot;task-start&quot;</span>)</span></span>
<span class="language-javascript"><span class="language-xml">            &#125;</span></span>
<span class="language-javascript"><span class="language-xml">            <span class="hljs-keyword">if</span> (task.<span class="hljs-property">status</span> != <span class="hljs-string">&quot;running&quot;</span>) &#123;</span></span>
<span class="language-javascript"><span class="language-xml">                <span class="hljs-title function_">addControlBtn</span>(td, <span class="hljs-string">&quot;编辑&quot;</span>, <span class="hljs-string">&quot;task-edit&quot;</span>)</span></span>
<span class="language-javascript"><span class="language-xml">                <span class="hljs-title function_">addControlBtn</span>(td, <span class="hljs-string">&quot;删除&quot;</span>, <span class="hljs-string">&quot;task-delete&quot;</span>)</span></span>
<span class="language-javascript"><span class="language-xml">            &#125;</span></span>
<span class="language-javascript"><span class="language-xml"></span></span>
<span class="language-javascript"><span class="language-xml">            tr.<span class="hljs-title function_">append</span>(td)</span></span>
<span class="language-javascript"><span class="language-xml">            tb.<span class="hljs-title function_">append</span>(tr)</span></span>
<span class="language-javascript"><span class="language-xml">        &#125;</span></span>
<span class="language-javascript"><span class="language-xml">    &#125;</span></span>
<span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">addControlBtn</span>(<span class="hljs-params">el, str, cls</span>) &#123;</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">let</span> bt = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Element</span>(#button, str)</span></span>
<span class="language-javascript"><span class="language-xml">        bt.@#<span class="hljs-keyword">class</span> = cls</span></span>
<span class="language-javascript"><span class="language-xml">        el.<span class="hljs-title function_">append</span>(bt)</span></span>
<span class="language-javascript"><span class="language-xml">    &#125;</span></span>
<span class="language-javascript"><span class="language-xml">    self.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;click&quot;</span>,<span class="hljs-string">&quot;.task-start&quot;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">let</span> id = <span class="hljs-variable language_">this</span>.$p(td).<span class="hljs-property">attributes</span>[<span class="hljs-string">&#x27;id&#x27;</span>].<span class="hljs-title function_">replace</span>(<span class="hljs-string">&quot;task-&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">let</span> result = view.<span class="hljs-title function_">startGoogleIndexing</span>(id)</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-comment">//view.msgbox(#alert, result || &quot;启动成功&quot;);</span></span></span>
<span class="language-javascript"><span class="language-xml">    &#125;);</span></span>
<span class="language-javascript"><span class="language-xml">    self.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;click&quot;</span>,<span class="hljs-string">&quot;.task-stop&quot;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">let</span> id = <span class="hljs-variable language_">this</span>.$p(td).<span class="hljs-property">attributes</span>[<span class="hljs-string">&#x27;id&#x27;</span>].<span class="hljs-title function_">replace</span>(<span class="hljs-string">&quot;task-&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">let</span> result = view.<span class="hljs-title function_">stopGoogleIndexing</span>(id)</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-comment">//view.msgbox(#alert, result || &quot;停止成功&quot;);</span></span></span>
<span class="language-javascript"><span class="language-xml">    &#125;);</span></span>
<span class="language-javascript"><span class="language-xml">    self.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;click&quot;</span>,<span class="hljs-string">&quot;.task-edit&quot;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">let</span> id = <span class="hljs-variable language_">this</span>.$p(td).<span class="hljs-property">attributes</span>[<span class="hljs-string">&#x27;id&#x27;</span>].<span class="hljs-title function_">replace</span>(<span class="hljs-string">&quot;task-&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-title function_">showEditWindow</span>(id)</span></span>
<span class="language-javascript"><span class="language-xml">    &#125;);</span></span>
<span class="language-javascript"><span class="language-xml">    self.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;click&quot;</span>,<span class="hljs-string">&quot;.task-result&quot;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">let</span> id = <span class="hljs-variable language_">this</span>.$p(td).<span class="hljs-property">attributes</span>[<span class="hljs-string">&#x27;id&#x27;</span>].<span class="hljs-title function_">replace</span>(<span class="hljs-string">&quot;task-&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)</span></span>
<span class="language-javascript"><span class="language-xml">        stdout.<span class="hljs-title function_">println</span>(<span class="hljs-variable language_">this</span>.$p(td).<span class="hljs-property">attributes</span>[<span class="hljs-string">&#x27;id&#x27;</span>])</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-title function_">showResultWindow</span>(id, <span class="hljs-number">1</span>)</span></span>
<span class="language-javascript"><span class="language-xml">    &#125;);</span></span>
<span class="language-javascript"><span class="language-xml">    self.<span class="hljs-title function_">on</span>(<span class="hljs-string">&quot;click&quot;</span>,<span class="hljs-string">&quot;.task-delete&quot;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">let</span> id = <span class="hljs-variable language_">this</span>.$p(td).<span class="hljs-property">attributes</span>[<span class="hljs-string">&#x27;id&#x27;</span>].<span class="hljs-title function_">replace</span>(<span class="hljs-string">&quot;task-&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">let</span> result = view.<span class="hljs-title function_">deleteGoogleIndexing</span>(id)</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-comment">//view.msgbox(#alert, result || &quot;删除成功&quot;);</span></span></span>
<span class="language-javascript"><span class="language-xml">    &#125;);</span></span>
<span class="language-javascript"><span class="language-xml">    <span class="hljs-comment">// 新建任务</span></span></span>
<span class="language-javascript"><span class="language-xml">    event click $(#newTask)&#123;</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-title function_">showEditWindow</span>(<span class="hljs-string">&quot;-1&quot;</span>)</span></span>
<span class="language-javascript"><span class="language-xml">    &#125;</span></span>
<span class="language-javascript"><span class="language-xml"></span></span>
<span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">showEditWindow</span>(<span class="hljs-params">id</span>) &#123;</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">let</span> res = view.<span class="hljs-title function_">getIndexingTask</span>(id);</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">let</span> result = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(res) || &#123;&#125;;</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-comment">// 回填表单</span></span></span>
<span class="language-javascript"><span class="language-xml">        $(#taslForm).<span class="hljs-property">value</span>=result;</span></span>
<span class="language-javascript"><span class="language-xml">        $(#taslForm).@.<span class="hljs-title function_">addClass</span>(<span class="hljs-string">&quot;active&quot;</span>);</span></span>
<span class="language-javascript"><span class="language-xml">    &#125;</span></span>
<span class="language-javascript"><span class="language-xml"></span></span>
<span class="language-javascript"><span class="language-xml">    <span class="hljs-comment">// 表单</span></span></span>
<span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">let</span> accountPath = <span class="hljs-string">&#x27;&#x27;</span>;</span></span>
<span class="language-javascript"><span class="language-xml">    event click $(#selectAccountJson)&#123;</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">let</span> filePath = view.<span class="hljs-title function_">openAccountJson</span>()</span></span>
<span class="language-javascript"><span class="language-xml">        self#accountJson.<span class="hljs-property">text</span> = filePath</span></span>
<span class="language-javascript"><span class="language-xml">        accountPath = filePath;</span></span>
<span class="language-javascript"><span class="language-xml">    &#125;</span></span>
<span class="language-javascript"><span class="language-xml">    event click $(#formClose)&#123;</span></span>
<span class="language-javascript"><span class="language-xml">        $(#taslForm).@.<span class="hljs-title function_">removeClass</span>(<span class="hljs-string">&quot;active&quot;</span>);</span></span>
<span class="language-javascript"><span class="language-xml">    &#125;</span></span>
<span class="language-javascript"><span class="language-xml"></span></span>
<span class="language-javascript"><span class="language-xml">    event click $(#taskSubmit)&#123;</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-comment">// 第一步，先保存授权信息</span></span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-comment">// 第二步，抓取Sitemap</span></span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-comment">// 第三步，开始推送</span></span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">let</span> result = view.<span class="hljs-title function_">createGoogleIndexing</span>(accountPath, $(#taslForm).<span class="hljs-property">value</span>.<span class="hljs-property">domain</span>, $(#taslForm).<span class="hljs-property">value</span>.<span class="hljs-property">daily_num</span>)</span></span>
<span class="language-javascript"><span class="language-xml">        stdout.<span class="hljs-title function_">println</span>(result)</span></span>
<span class="language-javascript"><span class="language-xml">        view.<span class="hljs-title function_">msgbox</span>(#alert, result || <span class="hljs-string">&quot;保存成功&quot;</span>);</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">if</span> (!result) &#123;</span></span>
<span class="language-javascript"><span class="language-xml">            $(#taslForm).@.<span class="hljs-title function_">removeClass</span>(<span class="hljs-string">&quot;active&quot;</span>);</span></span>
<span class="language-javascript"><span class="language-xml">        &#125;</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-comment">// 同步结果</span></span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-title function_">syncTasks</span>();</span></span>
<span class="language-javascript"><span class="language-xml">    &#125;</span></span>
<span class="language-javascript"><span class="language-xml"></span></span>
<span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">let</span> curId = <span class="hljs-number">0</span>;</span></span>
<span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">let</span> curPage = <span class="hljs-number">1</span>;</span></span>
<span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">let</span> totalPage = <span class="hljs-number">1</span>;</span></span>
<span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">showResultWindow</span>(<span class="hljs-params">id, curp</span>) &#123;</span></span>
<span class="language-javascript"><span class="language-xml">        curId = id;</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">let</span> res = view.<span class="hljs-title function_">getIndexingTask</span>(curId);</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">let</span> result = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(res) || &#123;&#125;;</span></span>
<span class="language-javascript"><span class="language-xml"></span></span>
<span class="language-javascript"><span class="language-xml">        $(#resultList).@.<span class="hljs-title function_">addClass</span>(<span class="hljs-string">&quot;active&quot;</span>);</span></span>
<span class="language-javascript"><span class="language-xml"></span></span>
<span class="language-javascript"><span class="language-xml">        $(#resultDomain).<span class="hljs-property">text</span> = result.<span class="hljs-property">domain</span>;</span></span>
<span class="language-javascript"><span class="language-xml">        $(#resultDailyNum).<span class="hljs-property">text</span> = result.<span class="hljs-property">daily_num</span> + <span class="hljs-string">&quot;条&quot;</span>;</span></span>
<span class="language-javascript"><span class="language-xml">        $(#resultStatus).<span class="hljs-property">text</span> = result.<span class="hljs-property">status</span>;</span></span>
<span class="language-javascript"><span class="language-xml">        $(#resultUrlCount).<span class="hljs-property">text</span> = result.<span class="hljs-property">url_count</span> + <span class="hljs-string">&quot;条&quot;</span>;</span></span>
<span class="language-javascript"><span class="language-xml">        $(#resultDailyFinished).<span class="hljs-property">text</span> = <span class="hljs-string">&quot;累计：&quot;</span> + result.<span class="hljs-property">total_finished</span> + <span class="hljs-string">&quot;条&quot;</span> + <span class="hljs-string">&quot; / 今日：&quot;</span> + result.<span class="hljs-property">daily_finished</span> + <span class="hljs-string">&quot;条&quot;</span> + (result.<span class="hljs-property">daily_finished</span> &gt;= result.<span class="hljs-property">daily_num</span> ? <span class="hljs-string">&#x27; / 今日已完成&#x27;</span> : <span class="hljs-string">&#x27;&#x27;</span>);</span></span>
<span class="language-javascript"><span class="language-xml">        </span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">let</span> res2 = view.<span class="hljs-title function_">getIndexingUrls</span>(curId, curp)</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">let</span> result2 = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(res2) || &#123;&#125;;</span></span>
<span class="language-javascript"><span class="language-xml"></span></span>
<span class="language-javascript"><span class="language-xml">        $(#resultPage).<span class="hljs-property">text</span> = result2.<span class="hljs-property">page</span> + <span class="hljs-string">&quot;&quot;</span>;</span></span>
<span class="language-javascript"><span class="language-xml">        $(#resultTotalPage).<span class="hljs-property">text</span> = result2.<span class="hljs-property">totalPage</span> + <span class="hljs-string">&quot;&quot;</span>;</span></span>
<span class="language-javascript"><span class="language-xml">        curPage = result2.<span class="hljs-property">page</span></span></span>
<span class="language-javascript"><span class="language-xml">        totalPage = result2.<span class="hljs-property">totalPage</span></span></span>
<span class="language-javascript"><span class="language-xml"></span></span>
<span class="language-javascript"><span class="language-xml">        $(#resultResult).<span class="hljs-property">html</span> = <span class="hljs-string">&#x27;&#x27;</span>;</span></span>
<span class="language-javascript"><span class="language-xml"></span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> val <span class="hljs-keyword">in</span> result2.<span class="hljs-property">urls</span>) &#123;</span></span>
<span class="language-javascript"><span class="language-xml">            $(#resultResult).<span class="hljs-title function_">append</span>(<span class="hljs-string">&quot;&lt;div class=&#x27;urls-item&#x27;&gt;&lt;span class=&#x27;item-url&#x27;&gt;&quot;</span> + val.<span class="hljs-property">url</span> + <span class="hljs-string">&quot;&lt;/span&gt;&amp;nbsp;&amp;nbsp;&lt;span class=&#x27;item-status&#x27; title=&#x27;&quot;</span>+(val.<span class="hljs-property">msg</span> || (val.<span class="hljs-property">status</span> == <span class="hljs-number">0</span> ? <span class="hljs-string">&#x27;未开始&#x27;</span> :<span class="hljs-string">&#x27;&#x27;</span>))+<span class="hljs-string">&quot;&#x27;&gt;&quot;</span> + (val.<span class="hljs-property">status</span> == <span class="hljs-number">0</span> ? <span class="hljs-string">&#x27;-&#x27;</span> : val.<span class="hljs-property">status</span> != <span class="hljs-number">200</span> ? <span class="hljs-string">&quot;&lt;span class=&#x27;status-error&#x27;&gt;&quot;</span>+val.<span class="hljs-property">status</span>+<span class="hljs-string">&quot;&lt;/span&gt;&quot;</span> : val.<span class="hljs-property">status</span>)+<span class="hljs-string">&quot;&lt;/span&gt;&lt;/div&gt;&quot;</span>)</span></span>
<span class="language-javascript"><span class="language-xml">        &#125;</span></span>
<span class="language-javascript"><span class="language-xml"></span></span>
<span class="language-javascript"><span class="language-xml">    &#125;</span></span>
<span class="language-javascript"><span class="language-xml"></span></span>
<span class="language-javascript"><span class="language-xml">    event click $(#resultPrev) &#123;</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">if</span>(curPage &lt;= <span class="hljs-number">1</span>) &#123;</span></span>
<span class="language-javascript"><span class="language-xml">            curPage = <span class="hljs-number">1</span>;</span></span>
<span class="language-javascript"><span class="language-xml">            <span class="hljs-keyword">return</span>;</span></span>
<span class="language-javascript"><span class="language-xml">        &#125;</span></span>
<span class="language-javascript"><span class="language-xml">        curPage = curPage - <span class="hljs-number">1</span>;</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-title function_">showResultWindow</span>(curId, curPage);</span></span>
<span class="language-javascript"><span class="language-xml">    &#125;</span></span>
<span class="language-javascript"><span class="language-xml"></span></span>
<span class="language-javascript"><span class="language-xml">    event click $(#resultNext) &#123;</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">if</span>(curPage &gt;= totalPage) &#123;</span></span>
<span class="language-javascript"><span class="language-xml">            curPage = totalPage;</span></span>
<span class="language-javascript"><span class="language-xml">            <span class="hljs-keyword">return</span>;</span></span>
<span class="language-javascript"><span class="language-xml">        &#125;</span></span>
<span class="language-javascript"><span class="language-xml">        curPage = curPage + <span class="hljs-number">1</span>;</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-title function_">showResultWindow</span>(curId, curPage);</span></span>
<span class="language-javascript"><span class="language-xml">    &#125;</span></span>
<span class="language-javascript"><span class="language-xml"></span></span>
<span class="language-javascript"><span class="language-xml">    event click $(.<span class="hljs-property">item</span>-status) &#123;</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">let</span> title = <span class="hljs-variable language_">this</span>.<span class="hljs-property">attributes</span>[<span class="hljs-string">&#x27;title&#x27;</span>];</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">if</span> (title) &#123;</span></span>
<span class="language-javascript"><span class="language-xml">            view.<span class="hljs-title function_">msgbox</span>(#error, title);</span></span>
<span class="language-javascript"><span class="language-xml">        &#125;</span></span>
<span class="language-javascript"><span class="language-xml">    &#125;</span></span>
<span class="language-javascript"><span class="language-xml"></span></span>
<span class="language-javascript"><span class="language-xml">    event click $(#resultClose)&#123;</span></span>
<span class="language-javascript"><span class="language-xml">        $(#resultList).@.<span class="hljs-title function_">removeClass</span>(<span class="hljs-string">&quot;active&quot;</span>);</span></span>
<span class="language-javascript"><span class="language-xml">        $(#taslForm).@.<span class="hljs-title function_">removeClass</span>(<span class="hljs-string">&quot;active&quot;</span>);</span></span>
<span class="language-javascript"><span class="language-xml">    &#125;</span></span>
<span class="language-javascript"><span class="language-xml">     <span class="hljs-comment">// 进来的时候先执行一遍</span></span></span>
<span class="language-javascript"><span class="language-xml">    <span class="hljs-title function_">syncTasks</span>();</span></span>
<span class="language-javascript"><span class="language-xml">    <span class="hljs-comment">// 加载tasklist,2秒钟刷新一次</span></span></span>
<span class="language-javascript"><span class="language-xml">    self.<span class="hljs-title function_">timer</span>(2000ms, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-title function_">syncTasks</span>();</span></span>
<span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</span></span>
<span class="language-javascript"><span class="language-xml">    &#125;);</span></span>
<span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span></code></pre>

<h3 id="使用帮助页面-views-help-html"><a href="#使用帮助页面-views-help-html" class="headerlink" title="使用帮助页面 views&#x2F;help.html"></a>使用帮助页面 views&#x2F;help.html</h3><p>使用帮助页面也是简简单单的HTML页面。这里只用到了一处的JS代码，用于调起系统浏览器，打开帮助文档页面。</p>
<pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">resizeable</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;home://views/style.css&quot;</span> /&gt;</span><span class="language-xml"></span>
<span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charSet</span>=<span class="hljs-string">&quot;utf-8&quot;</span> /&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;layout&quot;</span>&gt;</span></span>
<span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;aside&quot;</span>&gt;</span></span>
<span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;soft-title&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;home://views/main.html&quot;</span>&gt;</span>谷歌<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>推送助手<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>
<span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;aside-menus&quot;</span>&gt;</span></span>
<span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;home://views/task.html&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;menu-item&quot;</span>&gt;</span>推送任务<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span>
<span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;home://views/help.html&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;menu-item active&quot;</span>&gt;</span>使用教程<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span>
<span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span></span>
<span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;help-container&quot;</span>&gt;</span></span>
<span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> #<span class="hljs-attr">helpLink</span>&gt;</span>访问使用帮助页面<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;help-tips&quot;</span>&gt;</span>注意：一定要认真阅读帮助页面，每一个操作步骤都要细心按照教程执行，注意截图中的红字，否则容易出错。<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
<span class="language-xml"></span>
<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/tiscript&quot;</span>&gt;</span><span class="language-javascript"></span></span>
<span class="language-javascript"><span class="language-xml">  event click $(#helpLink)&#123;</span></span>
<span class="language-javascript"><span class="language-xml">    view.<span class="hljs-title function_">openUrl</span>(<span class="hljs-string">&quot;https://www.anqicms.com/google-indexing-help.html&quot;</span>)</span></span>
<span class="language-javascript"><span class="language-xml">  &#125;</span></span>
<span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span></code></pre>
  </article>

  <div class="nexmoe-post-meta nexmoe-rainbow">
    
        <a class="nexmoefont icon-appstore-fill -link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0/">技术文章</a>
    
    
        <a class="nexmoefont icon-tag-fill -none-link" href="/tags/go/" rel="tag">go</a>
    
</div>

  <div class="nexmoe-post-footer">
    
      

    
    <section class="nexmoe-comment">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.5.0/dist/gitalk.min.css">
<div id="gitalk"></div>
<script src="https://cdn.jsdelivr.net/npm/gitalk@1.5.0/dist/gitalk.min.js"></script>
<script type="text/javascript">
    var gitalk = new Gitalk({
        clientID: 'b1032eb4eb5c3aa428db',
        clientSecret: '1318f0e4e87894bf79a3353a0c372a0316e00dde',
        id: window.location.pathname,
        repo: 'blog',
        owner: 'ruanzhijun',
        admin: 'ruanzhijun'
    })
    gitalk.render('gitalk')
</script>
</section>
  </div>
</div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/combine/npm/lazysizes@5.1.0/lazysizes.min.js,gh/highlightjs/cdn-release@10.1.1/build/highlight.min.js,npm/mdui@0.4.3/dist/js/mdui.min.js,gh/nexmoe/nexmoe.github.io@latest/js/app.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<!--<script src="/js/app.js?v=1732079215027"></script>-->


    <script src="https://cdn.jsdelivr.net/gh/xtaodada/xtaodada.github.io@0.0.2/copy.js"></script>




  





</body>

</html>
